---
layout: post
title: "On Json Web Token" 
description: ""
category: 
tags: [architecture, security]
---

Motivation: decentralize the authorization process. Otherwise, each call in each service has to call a central authorization service. However, the role of JWT is AUTHENTICATION! This also suggests that authentication is centralized at the API gateway level, but authorization is at individual service level. 

Three parts: header, payload and signature.This means microservices need to know the public key to verify the signature.

Normally sent with the authorization header as the bearer token,i.e., use the bearer schema

API gateway will forward the request with JWT to the service, which will in turn will decide if it will grant the resource or not. 

We may choose to let user use a reference token, and API gateway will translate the reference token to the jwt token. Note the reference token can come from an OAuth server. This also suggests that JWT stays within the private network, and only reference token is on user's browser session

Common Choices
---------

1. Spring cloud security

2. keycloak by JBoss

3. OpenID-Connect-Java-Spring-Server

4. Apereo CAS

Workflow
----------
1. Client logs in to acquire access token

2. Client sends access token to the API gateway

3. Gateway uses auth server to validate token and convert to JWT

4. Gateway sends jwt token along with requests to backend microservices

5. Every microservice has JWT client to decrypt user context inside the jwt
